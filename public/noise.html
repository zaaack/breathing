<!DOCTYPE html>
<html>
<body>
    <h2>JS æ²»æ„ˆç³»ç™½å™ªå£°ç”Ÿæˆå™¨</h2>
    <button onclick="play('rain')">ğŸŒ§ï¸ ç»†é›¨</button>
    <button onclick="play('fire')">ğŸ”¥ ç¯ç«</button>
    <button onclick="play('wind')">ğŸŒ¬ï¸ å¾®é£</button>
    <button onclick="play('sea')">ğŸŒŠ æ·±æµ·</button>
    <button onclick="stop()">ğŸ›‘ åœæ­¢</button>

    <script>
        let audioCtx, source, gainNode, timer;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // åˆ›å»ºå™ªå£°ç¼“å†²åŒº (ç²‰çº¢/æ£•è‰²å™ªå£°æ¨¡æ‹Ÿ)
        function createNoiseBuffer(type) {
            const bufferSize = 2 * audioCtx.sampleRate;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = buffer.getChannelData(0);
            let lastOut = 0;

            for (let i = 0; i < bufferSize; i++) {
                let white = Math.random() * 2 - 1;
                if (type === 'brown') { // æ£•è‰²å™ªå£°ï¼šä½æ²‰
                    output[i] = (lastOut + (0.02 * white)) / 1.02;
                    lastOut = output[i];
                    output[i] *= 3.5;
                } else { // ç²‰çº¢å™ªå£°ï¼šå‡åŒ€å¹³æ»‘
                    output[i] = (lastOut + (0.1 * white)) / 1.1;
                    lastOut = output[i];
                }
            }
            return buffer;
        }

        function play(type) {
            stop();
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            source = audioCtx.createBufferSource();
            gainNode = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            if (type === 'rain') {
                source.buffer = createNoiseBuffer('pink');
                filter.type = 'lowpass';
                filter.frequency.value = 1500;
                gainNode.gain.value = 0.4;
            }
            else if (type === 'fire') {
                source.buffer = createNoiseBuffer('brown');
                filter.type = 'lowpass';
                filter.frequency.value = 400;
                gainNode.gain.value = 0.6;
                // æ·»åŠ éšæœºçˆ†è£‚å£°
                makeCrackle();
            }
            else if (type === 'wind') {
                source.buffer = createNoiseBuffer('pink');
                filter.type = 'bandpass';
                // æ¨¡æ‹Ÿé£å£°å˜å¹»
                const lfo = audioCtx.createOscillator();
                lfo.frequency.value = 0.1;
                const lfoGain = audioCtx.createGain();
                lfoGain.gain.value = 500;
                lfo.connect(lfoGain);
                lfoGain.connect(filter.frequency);
                filter.frequency.value = 800;
                lfo.start();
                gainNode.gain.value = 0.3;
            }
            else if (type === 'sea') {
                source.buffer = createNoiseBuffer('brown');
                filter.type = 'lowpass';
                filter.frequency.value = 150;
                gainNode.gain.value = 0.8;
            }

            source.loop = true;
            source.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            source.start();
        }

        // ç¯ç«ç‰¹æœ‰çš„çˆ†è£‚å£°å‡½æ•°
        function makeCrackle() {
            if (!source) return;
            const crackle = audioCtx.createOscillator();
            const crackleGain = audioCtx.createGain();

            crackle.type = 'square';
            crackle.frequency.value = 100;
            crackleGain.gain.setValueAtTime(0, audioCtx.currentTime);
            crackleGain.gain.exponentialRampToValueAtTime(0.02, audioCtx.currentTime + 0.01);
            crackleGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

            crackle.connect(crackleGain);
            crackleGain.connect(audioCtx.destination);
            crackle.start();
            crackle.stop(audioCtx.currentTime + 0.05);

            timer = setTimeout(makeCrackle, Math.random() * 2000 + 100);
        }

        function stop() {
            if (source) {
                source.stop();
                source = null;
            }
            clearTimeout(timer);
        }
    </script>
</body>
</html>
