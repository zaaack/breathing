<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>åŠ¨æ€è‡ªç„¶éŸ³æ•ˆç”Ÿæˆå™¨</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; background: #f0f4f8; }
        button { padding: 15px 30px; font-size: 16px; margin: 10px; cursor: pointer; border-radius: 8px; border: none; background: #2196F3; color: white; }
        button:hover { background: #1976D2; }
        .stop { background: #f44336; }
    </style>
</head>
<body>
    <h2>åŠ¨æ€è‡ªç„¶éŸ³æ•ˆ (ä¸€é˜µé˜µçš„æ•ˆæœ)</h2>
    <button onclick="playOcean()">ğŸŒŠ é˜µé˜µæµ·æµª</button>
    <button onclick="playWind()">ğŸŒ¬ï¸ é˜µé˜µé˜µé£</button>
    <button class="stop" onclick="stopAll()">ğŸ›‘ åœæ­¢æ‰€æœ‰</button>

    <script>
        let audioCtx;
        let activeNodes = [];

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // ç”Ÿæˆç²‰çº¢å™ªå£° (æ›´è‡ªç„¶çš„åº•å™ª)
        function createPinkNoiseBuffer() {
            const bufferSize = 4 * audioCtx.sampleRate;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = buffer.getChannelData(0);
            let b0, b1, b2, b3, b4, b5, b6;
            b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
            for (let i = 0; i < bufferSize; i++) {
                let white = Math.random() * 2 - 1;
                b0 = 0.99886 * b0 + white * 0.0555179;
                b1 = 0.99332 * b1 + white * 0.0750759;
                b2 = 0.96900 * b2 + white * 0.1538520;
                b3 = 0.86650 * b3 + white * 0.3104856;
                b4 = 0.55000 * b4 + white * 0.5329522;
                b5 = -0.7616 * b5 - white * 0.0168980;
                output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                output[i] *= 0.11; // ä¿®æ­£éŸ³é‡
                b6 = white * 0.115926;
            }
            return buffer;
        }

        // ğŸŒŠ æ¨¡æ‹Ÿé˜µé˜µæµ·æµª
        function playOcean() {
            stopAll();
            initAudio();

            const noise = audioCtx.createBufferSource();
            noise.buffer = createPinkNoiseBuffer();
            noise.loop = true;

            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400;

            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0.001;

            // æ ¸å¿ƒï¼šæ¨¡æ‹Ÿæµ·æµªå‘¨æœŸ (çº¦ 8 ç§’ä¸€ä¸ªæ¥å›)
            const now = audioCtx.currentTime;
            const period = 8;
            for (let i = 0; i < 100; i++) {
                const t = now + i * period;
                // æµªæ¥ï¼šéŸ³é‡å˜å¤§ï¼Œé¢‘ç‡ç¨å¾®å‡é«˜ï¼ˆå¬èµ·æ¥æ›´è¿‘ï¼‰
                gainNode.gain.exponentialRampToValueAtTime(0.6, t + 3);
                filter.frequency.exponentialRampToValueAtTime(800, t + 3);
                // æµªå»ï¼šéŸ³é‡å˜å°ï¼Œé¢‘ç‡é™ä½ï¼ˆé€€æ½®æ„Ÿï¼‰
                gainNode.gain.exponentialRampToValueAtTime(0.01, t + period);
                filter.frequency.exponentialRampToValueAtTime(300, t + period);
            }

            noise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            noise.start();
            activeNodes.push(noise);
        }

        // ğŸŒ¬ï¸ æ¨¡æ‹Ÿé˜µé˜µé˜µé£
        function playWind() {
            stopAll();
            initAudio();

            const noise = audioCtx.createBufferSource();
            noise.buffer = createPinkNoiseBuffer();
            noise.loop = true;

            const filter = audioCtx.createBiquadFilter();
            filter.type = 'bandpass'; // å¸¦é€šæ»¤æ³¢å™¨è®©é£å£°æœ‰â€œå‘œå‘œâ€çš„å…±é¸£
            filter.Q.value = 5;       // Qå€¼è¶Šé«˜ï¼Œå‘¼å•¸æ„Ÿè¶Šæ˜æ˜¾

            const gainNode = audioCtx.createGain();

            // ä½¿ç”¨ä½é¢‘æŒ¯è¡å™¨ (LFO) æ§åˆ¶é£çš„èµ·ä¼
            const lfo = audioCtx.createOscillator();
            lfo.type = 'sine';
            lfo.frequency.value = 0.15; // é£å¹çš„é¢‘ç‡ï¼šå¤§çº¦ 6-7 ç§’ä¸€é˜µ

            const lfoGain = audioCtx.createGain();
            lfoGain.gain.value = 600; // é£å£°æ‰«é¢‘çš„èŒƒå›´

            lfo.connect(lfoGain);
            lfoGain.connect(filter.frequency); // LFO æ§åˆ¶æ»¤æ³¢å™¨é¢‘ç‡
            filter.frequency.value = 800;

            // åŒæ—¶è®©éŸ³é‡ä¹Ÿéšé£é€Ÿå˜åŒ–
            const vcaLfo = audioCtx.createGain();
            vcaLfo.gain.value = 0.3;
            lfo.connect(vcaLfo); // å€Ÿç”¨åŒä¸€ä¸ª LFO æ§åˆ¶éŸ³é‡

            noise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            lfo.start();
            noise.start();
            activeNodes.push(noise, lfo);
        }

        function stopAll() {
            activeNodes.forEach(node => {
                try { node.stop(); } catch(e) {}
            });
            activeNodes = [];
        }
    </script>
</body>
</html>
